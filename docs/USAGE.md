# Overview

The ðŸ¥‘ gem is a [Rails Engine] meant to sit on top of a generated authentication
system within a Rails application.

## Requirements

Apps must be running Rails 8.0 or newer. The ðŸ¥‘ gem uses some features which
don't exist in earlier versions, and only works by extending the authentication
system from running `bin/rails g authentication`.

The database schema is expected to match what is generated from the Rails
generators for `users` and `sessions`. There is also an `events` table and an
additional `verified` column on `users`. The [demo app schema] shows what is
expected. More columns in each table are acceptable; the demo is just a minimum.

Run `bin/rails g avocado:migrations` to generate migrations which will create
the `events` table and add the `verified` column to `users`.

The application must also have:

- An `ApplicationController` base controller class for the controllers to
  inherit from.
- An `ApplicationMailer` base mailer class which sets a layout and default
  `from` value.
- A `root_path` route helper method (typically generated by routes configured in
  the application).

## Usage

### Models

Within the Rails-generated `Session` and `User` models, add inclusion of
`Avocado::Session` and `Avocado::User`, using the demo app as an example.

Additionally, add an `Event` class:

```ruby
class Event < ApplicationRecord
  include Avocado::Event
end
```

### Routes

By defalt, ðŸ¥‘ does not add any routes to the application when initialized. To
hook up the controllers to routes, they must be added to the `config/routes.rb`
of the application. It's possible to add all of the routes, or just a subset.

This example pulls in every feature route:

```ruby
Rails.application.routes.draw do
  draw(ðŸ¥‘)
end
```

This example adds only a subset of feature routes:

```ruby
Rails.application.routes.draw do
  scope module: ðŸ¥‘ do
    resources :registrations, only: %i[new create]
  end
end
```

## Summary

### Routable controller features

The ðŸ¥‘ gem will create REST-ful routes that go to the various controllers during
app initialization.

These external (unauthenticated) features are available:

- `Registrations` -- Fill out new user form and create users
- `Verifications` -- Confirm email address on account creation or email change
- `Affirmations` -- "Passwordless" authentication via emailed expiring link

These internal (authenticated) features are available:

- `Sessions` -- Index view of active sessions
- `Events` -- Index view of the user activity audit log
- `Profiles` -- Edit and update a user password
- `Emails` -- Edit and update a user email

Linking to any of these internal pages is optional. Apps can use them as-is,
override their views, or even ignore them entirely and make local versions.

### Mailers

There is an `Avocado::Mailer` which gets called to send emails. The mailer views
here are very basic, and should be overridden within applications. Place views
within `app/views/avocado/mailer/` to make this happen.

## Customization

There is not any configuration. In order to override functionality:

- Redefine a method created in one of the models by the included module
- Subclass a controller and update the routing to go to the subclass
- Place views in the app where ðŸ¥‘ expects them (`app/views/avocado`) to override

There is an `avocado:views` generator which will copy all the views as a
starting point for further modification.

## Examples

There is a [demo app] used by the specs which has some example usage. The demo
app includes both the output of a `bin/rails g authentication` run, and also has
the additions needed by ðŸ¥‘.

[demo app schema]: https://github.com/tcuwp/avocado/blob/main/spec/internal/db/schema.rb
[demo app]: https://github.com/tcuwp/avocado/blob/main/spec/internal
[Rails Engine]: https://guides.rubyonrails.org/engines.html#what-are-engines-questionmark
